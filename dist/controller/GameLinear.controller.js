sap.ui.define(["learninggame/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/VBox","sap/m/HBox","sap/m/CheckBox","sap/m/Text","sap/m/Button","sap/m/Panel"],function(e,t,s,n,o,r,i,a,l){"use strict";return e.extend("learninggame.controller.GameLinear",{onInit:function(){this.oGameSettings=this.getOwnerComponent().getModel("GameSettings");if(!this.oGameSettings.getProperty("/settingsAreSet")){this.getOwnerComponent().getRouter().navTo("RouteStartPage");return}if(!this.oGameSettings.getProperty("/correctAnswersCount")){this.oGameSettings.setProperty("/correctAnswersCount",0)}this._prepareQuiz().then(()=>this._createLinearSteps()).catch(e=>console.error("Fehler beim Quiz vorbereiten:",e))},_prepareQuiz:function(){return new Promise((e,s)=>{const n=new t;n.loadData("/model/FioriQuestions.json");n.attachRequestCompleted(()=>{const o=n.getData();if(!o||!o.results)return s("Keine Fragen im JSON");let r=o.results;const i=this.oGameSettings.getProperty("/numberOfQuestions")||3;const a=this.oGameSettings.getProperty("/selectedTopics")||[];if(a.length>0){r=r.filter(e=>a.includes(e.QuestionTopicArea))}r=r.sort(()=>.5-Math.random());const l=r.slice(0,i);const c=l.map(e=>({QuestionID:e.QuestionID,QuestionText:e.QuestionText,AmountOfTrueAnswers:e.AmountOfTrueAnswers,Answers:["A","B","C","D","E","F"].map(t=>({key:t,text:e["Answer"+t],correct:e["Answer"+t+"_boolean"],selected:false})).filter(e=>e.text).sort(()=>.5-Math.random())}));const d=new t({questions:c});this.getView().setModel(d,"quiz");e()});n.attachRequestFailed(e=>s(e))})},_createLinearSteps:function(){const e=this.byId("quizContainerVBox");if(!e){console.error("Container Control nicht gefunden!");return}const t=this.getView().getModel("quiz").getProperty("/questions");this._questionControls=[];t.forEach((t,s)=>{const c=new i({text:t.QuestionText,wrapping:true});c.addStyleClass("sapUiMediumMarginBottom");const d=new n({width:"100%"});d.addItem(c);d.addItem(new i({text:`Anzahl korrekter Antworten: ${t.AmountOfTrueAnswers}`,wrapping:true,class:"sapUiSmallMarginTop sapUiEmphasizedText"}));const u=new n({width:"100%"});u.addStyleClass("sapUiMediumMarginBottom sapUiMediumMarginBeginEnd");const m=t.Answers.map(e=>{const t=new r({text:e.text,selected:e.selected,enabled:true});t.addStyleClass("sapUiTinyMarginBottom");return t});m.forEach(e=>u.addItem(e));const g=new a({text:"BestÃ¤tigen",type:"Emphasized",press:()=>this.onCheckAnswerLinear(t,m,h,s)});g.addStyleClass("sapUiSmallMarginBottom sapUiMediumMarginBegin");const p=new n;p.setVisible(false);p.addStyleClass("sapUiSmallMarginTop sapUiMediumMarginBeginEnd");const h=new l({headerText:`Frage ${s+1}`,expandable:false,width:"100%",content:[d,u,new o({items:[g]}),p],visible:s===0});h.addStyleClass("sapUiLargeMarginBottom customCardPanel");h._oVBoxSolutionBelow=p;e.addItem(h);this._questionControls.push(h)})},onCheckAnswerLinear:function(e,t,n,a){let l=0;e.Answers.forEach((e,s)=>{const n=t[s];e.selected=n.getSelected();n.setEnabled(false);if(e.selected&&e.correct||!e.selected&&!e.correct){n.addStyleClass("sapUiTextSuccess")}else{n.addStyleClass("sapUiTextError")}if(e.selected===e.correct&&e.correct){l++}});const c=n._oVBoxSolutionBelow;c.removeAllItems();c.addItem(new i({text:"Richtige Antworten:"}));e.Answers.forEach(e=>{const t=new r({text:e.text,selected:e.correct,enabled:false});if(e.selected&&e.correct||!e.selected&&!e.correct){t.addStyleClass("solutionCorrect")}else{t.addStyleClass("solutionWrong")}c.addItem(t)});c.setVisible(true);if(l===e.AmountOfTrueAnswers){const e=this.oGameSettings.getProperty("/correctAnswersCount")+1;this.oGameSettings.setProperty("/correctAnswersCount",e)}n.getContent().forEach(e=>{if(e instanceof o)e.getItems().forEach(e=>e.setEnabled(false))});const d=this._questionControls[a+1];if(d){d.setVisible(true)}else{const e=this.oGameSettings.getProperty("/correctAnswersCount");const t=this._questionControls.length;s.show(`Du hast ${e} von ${t} richtig beantwortet!`)}}})});
//# sourceMappingURL=GameLinear.controller.js.map