sap.ui.define(["learninggame/controller/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/WizardStep","sap/m/HBox","sap/m/VBox","sap/m/CheckBox","sap/m/Text","sap/m/Button"],function(e,t,s,o,n,r,i,a,l){"use strict";return e.extend("learninggame.controller.GameWizard",{onInit:function(){console.log("GameWizard.onInit gestartet");this.oGameSettings=this.getOwnerComponent().getModel("GameSettings");if(!this.oGameSettings.getProperty("/settingsAreSet")){console.warn("Settings nicht gesetzt – zurück zur StartPage");this.getOwnerComponent().getRouter().navTo("RouteStartPage");return}if(!this.oGameSettings.getProperty("/correctAnswersCount")){this.oGameSettings.setProperty("/correctAnswersCount",0)}this._prepareQuiz().then(()=>this._createWizardSteps()).catch(e=>console.error("Fehler beim Quiz vorbereiten:",e))},onShowSettings:function(){console.log("GameSettings aktuell:",this.oGameSettings.getData())},onShowSettingsAfterChange:function(){this.oGameSettings.setProperty("/numberOfQuestions",3);console.log("GameSettings nach Änderung:",this.oGameSettings.getData())},_prepareQuiz:function(){console.log("Starte Laden der Fragen aus JSON...");return new Promise((e,s)=>{const o=new t;o.loadData("/model/FioriQuestions.json");o.attachRequestCompleted(()=>{console.log("FioriQuestions.json geladen:",o.getData());const n=o.getData();if(!n||!n.results){console.error("Keine Fragen gefunden!");s("Keine Fragen im JSON");return}let r=n.results;const i=this.oGameSettings.getProperty("/numberOfQuestions")||3;const a=this.oGameSettings.getProperty("/selectedTopics")||[];console.log("Gefiltert nach Topics:",a);if(a.length>0){r=r.filter(e=>a.includes(e.QuestionTopicArea))}console.log("Gefilterte Fragen:",r);const l=this._getRandomItems(r,i);console.log("Zufällige Auswahl:",l);const c=l.map(e=>({QuestionID:e.QuestionID,QuestionText:e.QuestionText,AmountOfTrueAnswers:e.AmountOfTrueAnswers,feedbackShown:false,Answers:["A","B","C","D","E","F"].map(t=>({key:t,text:e["Answer"+t],correct:e["Answer"+t+"_boolean"],selected:false,feedback:""})).filter(e=>e.text).sort(()=>Math.random()-.5)}));console.log("Quiz Questions vorbereitet:",c);const g=new t({currentStep:0,questions:c});this.getView().setModel(g,"quiz");console.log("QuizModel gesetzt!");e()});o.attachRequestFailed(e=>{console.error("Fehler beim Laden von FioriQuestions.json:",e);s(e)})})},_getRandomItems:function(e,t){return e.sort(()=>.5-Math.random()).slice(0,t)},_createWizardSteps:function(){console.log("WizardSteps werden erstellt...");const e=this.byId("quizWizard");if(!e){console.error("Wizard Control nicht gefunden!");return}const t=this.getView().getModel("quiz").getProperty("/questions");console.log("Fragen für Wizard:",t);t.forEach((s,c)=>{const g=`Frage ${c+1}`;const u=new o({title:g,id:"step"+s.QuestionID,visible:c===0});const d=new a({text:s.QuestionText,wrapping:true});u.addContent(d);const m=new r({class:"sapUiSmallMarginTop"});const p=s.Answers.map(e=>new i({text:e.text,selected:e.selected,enabled:true}));p.forEach(e=>m.addItem(e));u.addContent(m);const f=new l({text:"Bestätigen",press:()=>this.onCheckAnswerLinear(s,p,f,u,c,t)});u.addContent(new n({items:[f],class:"sapUiSmallMarginTop"}));const h=new r({class:"sapUiSmallMarginTop"});h.setVisible(false);u.addContent(h);u._oVBoxSolutionBelow=h;e.addStep(u)});console.log("WizardSteps erfolgreich erstellt!")},onCheckAnswerLinear:function(e,t,s,o,n,r){let l=0;e.Answers.forEach((e,s)=>{const o=t[s];e.selected=o.getSelected();o.setEnabled(false);if(e.selected===e.correct){o.addStyleClass("sapUiTextSuccess")}else{o.addStyleClass("sapUiTextError")}if(e.correct&&e.selected)l++});const c=o._oVBoxSolutionBelow;c.removeAllItems();c.addItem(new a({text:"Richtige Antworten:"}));e.Answers.forEach(e=>{const t=new i({text:e.text,selected:e.correct,enabled:false});if(e.correct)t.addStyleClass("solutionCorrect");else t.addStyleClass("solutionWrong");c.addItem(t)});c.setVisible(true);if(l===e.AmountOfTrueAnswers){const e=this.oGameSettings.getProperty("/correctAnswersCount")+1;this.oGameSettings.setProperty("/correctAnswersCount",e)}s.setEnabled(false);const g=this.byId("quizWizard");const u=r[n+1];if(u){const e=g.getSteps().find(e=>e.getId()==="step"+u.QuestionID);if(e)e.setVisible(true)}}})});
//# sourceMappingURL=GameWizard.controller.js.map